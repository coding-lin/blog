---
title: 栈空间和堆空间：数据是如何存储的？
author: codinglin
date: 2023-2-9
categories:
  - 前端
tags:
  - JavaScript
sticky: 14
---

## 栈空间和堆空间：数据是如何存储的？

```js
function foo() {
  var a = 1;
  var b = a;
  a = 2;
  console.log(a);
  console.log(b);
}
foo();
```

执行以上代码，打印出来 a 的值是 2，b 的值是 1。

```js
function foo() {
  var a = { name: "极客时间" };
  var b = a;
  a.name = "极客邦";
  console.log(a);
  console.log(b);
}
foo();
```

执行以上代码，你会发现，仅仅改变了 a 中 `name` 的属性值，但是最终 a 和 b 打印出来的值都是 `{name:"极客邦"}`。

### JavaScript 是什么类型的语言？

支持隐式类型转换的语言称为**弱类型语言**，不支持隐式类型转换的语言称为**强类型语言**。在这点上，C 和 JavaScript 都是弱类型语言。

<img src="https://static001.geekbang.org/resource/image/36/f0/36f0f5bdce0a6d8c36cbb8a76931cff0.png?wh=1142*815"/>

- 弱类型，意味着你不需要告诉 JavaScript 引擎这个或那个变量是什么数据类型，JavaScript 引擎在运行代码的时候自己会计算出来。

- 动态，意味着你可以使用同一个变量保存不同类型的数据。

### 内存空间

在 JavaScript 的执行过程中， 主要有三种类型内存空间，分别是**代码空间**、**栈空间**和**堆空间**。其中的代码空间主要是存储可执行代码的。栈空间就是我们之前反复提及的调用栈，是用来存储执行上下文的。

对象类型是存放在堆空间的，在栈空间中只是保留了对象的引用地址，当 JavaScript 需要访问该数据的时候，是通过栈中的引用地址来访问的。

原始类型的数据值都是直接保存在“栈”中的，引用类型的值是存放在“堆”中的。这是因为通常情况下，栈空间都不会设置太大，主要用来存放一些原始类型的小数据。而引用类型的数据占用的空间都比较大，所以这一类数据会被存放到堆中，堆空间很大，能存放很多大的数据，不过缺点是分配内存和回收内存都会占用一定的时间。

在 JavaScript 中，赋值操作和其他语言有很大的不同，原始类型的赋值会完整复制变量值，而引用类型的赋值是**复制引用地址**。

产生闭包的核心有两步：第一步是需要预扫描内部函数；第二步是把内部函数引用的外部变量保存到堆中。
